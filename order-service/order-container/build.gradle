plugins {
    id 'java'
    id 'checkstyle'
    id 'jacoco'
    alias pluginLibs.plugins.spotbugs
    alias pluginLibs.plugins.spring.boot
    alias pluginLibs.plugins.graphfity
}

apply from: "${rootDir}/java.gradle"

configurations {
    runtimeOnly.exclude group: 'ch.qos.logback'
    runtimeOnly.exclude group: 'org.apache.logging.log4j', module: 'log4j-to-slf4j'
}

dependencies {
    implementation project(":order-service:order-domain:order-domain-core")
    implementation project(":order-service:order-domain:order-application-service")
    implementation project(":order-service:order-presentation:order-rest-controller")
    implementation project(":order-service:order-infrastructure:order-data-access")
    implementation project(":order-service:order-infrastructure:order-messaging")

    implementation libs.spring.beans
    implementation libs.spring.boot.actuator
    implementation libs.spring.boot.autoconfigure
    implementation libs.spring.boot.core
    implementation libs.spring.context
    implementation libs.spring.data.commons
    implementation libs.spring.data.jpa

    runtimeOnly libs.jackson.databind
    runtimeOnly libs.jackson.dataformat.yaml
    runtimeOnly libs.log4j.core
    runtimeOnly libs.log4j.json.layout
    runtimeOnly libs.log4j.slf4j
    runtimeOnly libs.postgresql.driver
    runtimeOnly libs.spring.boot.data.jpa
    runtimeOnly libs.spring.boot.validation
    runtimeOnly libs.spring.boot.web
}

springBoot {
    mainClass = 'com.acroteq.ticketing.order.service.container.OrderServiceApplication'
}

bootBuildImage {
    imageName = "${dockerNamespace}/${rootProject.name}/${project.name}:${project.version}"
}

graphfityExtension {
    nodeTypesPath = "${projectDir}/graphfityNodeTypes.json"
    projectRootName = "${project.path}"
    graphImagePath = "${buildDir}/"
}

test {
    useJUnitPlatform()
    testLogging {
        events "passed", "skipped", "failed"
    }
}